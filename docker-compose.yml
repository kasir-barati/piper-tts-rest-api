services:
  # Helper service to create output directory with correct permissions
  init:
    image: alpine:latest
    user: "1000:1000"
    volumes:
      - ./output:/output
    command: sh -c "mkdir -p /output && echo 'Output directory ready with correct permissions'"
    
  markdown-to-audio:
    build: .
    container_name: markdown-to-audio
    user: "1000:1000"
    volumes:
      - ./input:/app/input:ro
      - ./output:/app/output
    environment:
      - NODE_ENV=production
    depends_on:
      init:
        condition: service_completed_successfully
